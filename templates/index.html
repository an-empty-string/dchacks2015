<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Heatmaps</title>
        <style>
            html, body, #map-canvas {
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #panel {
                position: absolute;
                top: 5px;
                left: 50%;
                margin-left: -180px;
                z-index: 5;
                background-color: #fff;
                padding: 5px;
                border: 1px solid #999;
            }

            #panel, .panel {
                font-family: 'Roboto','sans-serif';
                line-height: 30px;
                padding-left: 10px;
            }

            #panel select, #panel input, .panel select, .panel input {
                font-size: 15px;
            }

            #panel select, .panel select {
                width: 100%;
            }

            #panel i, .panel i {
                font-size: 12px;
            }

        </style>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=visualization"></script>
        <script type="text/javascript">
var map, pointarray, heatmap;


function setupStations() {
    $.get("/gen/data2.csv", {}, function(d) {

        var lines = d.split("\n");
        for(var i=0; i<lines.length; i++) {
            var pt = lines[i].split(",");
            var loc = new google.maps.LatLng(parseFloat(pt[0]), parseFloat(pt[1]));
            var weight = parseFloat(pt[2]) * 100;
            var marker = new google.maps.Marker({
                map: map,
                position: loc,
                title: "Station",
                icon: "/static/station.png"
            });
            var circle = new google.maps.Circle({
                map: map,
                radius: 500,
                fillColor: 'green',
                fillOpacity: 0.3,
                strokeWeight: 0
            });
            circle.bindTo('center', marker, 'position');
        }
    });
}

function init() {
    console.debug("init map");
    var mapOptions = {
        zoom: 13,
        center: new google.maps.LatLng(38.904815, -77.016190),
        mapTypeId: google.maps.MapTypeId.MAP
    };

    map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);

    /*map.data.setStyle(function(feature) {
        var magnitude = feature.getProperty('mag');
        return {
            icon: {
                path: google.maps.SymbolPath.CIRCLE,
                scale: magnitude
            }
        };
    });*/

    setupStations();
    
}

google.maps.event.addDomListener(window, 'load', function() {
    init();
    
});

        </script>
    </head>

    <body>
        <div id="panel" style="display:none">
        </div>
        <div id="map-canvas"></div>
    </body>
</html>